<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition template="/template_PROI_PRIKAZOVALNIKI.xhtml">

        <ui:define name="PageHeader">


            <style type="text/css">
                .wrapper-content {
                    padding-top: 5px !important;
                    padding: initial;
                }

                .rdecHeader{
                    background-color: #f75454 !important;
                    color: white !important;               
                }

                .rdecHeaderUra{
                    background-color: #f75454 !important;
                    color: white !important;
                    float: right;
                }

                .belHeaderUra{
                    float: right;
                }

                .jqplot-meterGauge-tick {
                    font-size: 1.5em;
                    color: black !important;
                    font-weight: bold;
                }

                body .ui-clock {
                    border: 0px solid transparent;
                    background: transparent !important;
                    color: #495057;
                    padding:0;
                    font-size: unset !important;
                    float: right;
                }

                .dashboardText{
                    //font-size: x-large;
                    font-size: 35px;
                    font-weight: bold;
                }

                .dashboardTitle{
                    //font-size: x-large;
                    font-size: 35px;
                }

                .ibox-title h5 {
                    display: block;
                    font-size: 14px;
                    margin: 0 0 7px;
                    padding: 0;
                    text-overflow: ellipsis;
                    float: none;
                    text-align: center;
                }

                .ibox-content {
                    text-align: left;
                    background-color: #ffffff;
                    color: inherit;
                    padding: 15px 0px 20px 10px;
                    border-color: #e7eaec;
                    border-image: none;
                    border-style: solid solid none;
                    border-width: 1px 0;
                }

                .ibox-content-okvircek {
                    text-align: center;
                    background-color: #ffffff;
                    color: inherit;
                    //padding: 15px 0px 20px 10px;
                    border-color: #e7eaec;
                    border-image: none;
                    border-style: solid solid none;
                    border-width: 1px 0;

                    width: 100%;
                    height: 500px;
                }

                .ibox-title {
                    padding: 15px 20px 8px 20px;
                }

                h1 {
                    font-size: 150px;
                }

                h2{
                    font-size: 3rem;
                }

                .ibox-title h2 {
                    display: block;
                    font-size: 34px;
                    font-weight: bold;
                    margin: 0 0 7px;
                    padding: 0;
                    text-overflow: ellipsis;
                    float: none;
                }

                /* test */
                #chartdiv {
                    width: 100%;
                    height: 400px;
                }

                #chartdivZastoji {
                    width: 100%;
                    height: 400px;
                }

                #chartdivIzmet {
                    width: 100%;
                    height: 400px;
                }

                highcharts-figure .chart-container {
                    width: 300px;
                    height: 200px;
                    float: left;
                }

                .highcharts-figure,
                .highcharts-data-table table {
                    width: 600px;
                    margin: 0 auto;
                }

                .highcharts-data-table table {
                    font-family: Verdana, sans-serif;
                    border-collapse: collapse;
                    border: 1px solid #ebebeb;
                    margin: 10px auto;
                    text-align: center;
                    width: 100%;
                    max-width: 500px;
                }

                .highcharts-data-table caption {
                    padding: 1em 0;
                    font-size: 1.2em;
                    color: #555;
                }

                .highcharts-data-table th {
                    font-weight: 600;
                    padding: 0.5em;
                }

                .highcharts-data-table td,
                .highcharts-data-table th,
                .highcharts-data-table caption {
                    padding: 0.5em;
                }

                .highcharts-data-table thead tr,
                .highcharts-data-table tr:nth-child(even) {
                    background: #f8f8f8;
                }

                .highcharts-data-table tr:hover {
                    background: #f1f7ff;
                }

                @media (max-width: 600px) {
                    .highcharts-figure,
                    .highcharts-data-table table {
                        width: 100%;
                    }

                    .highcharts-figure .chart-container {
                        width: 300px;
                        float: none;
                        margin: 0 auto;
                    }
                }

                marquee{
                    vertical-align: top;
                }

                .jqplot-meterGauge-tick::before{
                    content:'2';
                }
                .jqplot-meterGauge-tick::first-letter{
                    color:transparent;
                }

                body .ui-dialog .ui-dialog-titlebar .ui-dialog-title {
                    margin: 0;
                    float: none;
                    font-size: 3.25rem;
                }

            </style>

            <h:form id="formClock">
                Linija: <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.lineName}"/><h:outputText id="clck" styleClass="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.indowntime eq '1' ? 'rdecHeaderUra' : 'belHeaderUra'}" value="#{prodDisplaySingleWorkcenterBean.dateNow}"><f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss" timeZone="Europe/Ljubljana" /></h:outputText>
                <!--<p:poll interval="1" global="false" form="formClock" update="clck"/>-->
            </h:form>

            <script type="text/javascript">
                function posodobiPodatke() {
                    console.log('sem v posodobiPodatke:');
                    axisDataItem.set("value", 50);
                }

                ion.sound({
                    sounds: [
                        {name: "bell_ring"
                        },
                        {
                            name: "button_tiny"
                        }
                    ],
                    // main config
                    path: "/osloWebApp/sounds/",
                    preload: true,
                    multiplay: true,
                    volume: 0.9
                });

                var oeeVarForChart = 99;
                var zastojiVarForChart = 10;
                var izmetVarForChart = 5;

                function handleOpen(event) {
                    console.log('Openning ', event);
                }

                function handleClose(code, channel, event) {
                    console.log('Handle close: ' + code, channel, event);
                    if (code == -1) {
                        console.log('Websockets not supported by client')
                    } else if (code == 1000) { // Normal close (as result of expired session or view)
                        console.log('Normal close, will try to reconnect');
                    } else {
                        // Abnormal close reason (as result of an error)
                        alert('Error during the reconnect! Please refresh WebPage')
                    }
                }

                function handleMessage(message, channelName, event) {
                    const obj = JSON.parse(message);
                    if (channelName === 'PROIDisplaysChannel') {
                        //console.log('handleMessage - AGVchannel ', event);
                        refresh(message, event);
                    } else if (channelName === 'PROIDisplaysChannelRefresh') {
                        //console.log('handleMessage - AGVchannel ', event);
                        refreshPage();
                    } else if (channelName === 'PROIDisplaysChannelMessage') {
                        if (obj.action == 'show') {
                            var obvestiloplace = document.getElementById('formObvestilo:obvestilomessage');
                            obvestiloplace.innerHTML = "" + obj.message;
                            var pic = document.getElementById('imgfoto');
                            pic.src = "" + obj.image;
                            PF('dlg2').show();
                        } else {
                            PF('dlg2').hide();
                        }

                    } else {
                        alert('Unhandled channel: ' + channelName);
                    }
                }

                function refresh(message, event) {
                    const obj = JSON.parse(message);
                    ion.sound.play("button_tiny");
                    PF('PROIgrowl').renderMessage({summary: "Message from server", detail: obj.message + "", severity: obj.severity});
                    //updateDataView();
                    //Ajax.update("wpcontainer");
                    rcrefresh();
                }

                function updateTest() {
                    console.log('Sem v updateTest()');
                    rcrefresh();
                }

                function refreshPage() {
                    ion.sound.play("bell_ring");
                    window.location.reload();
                }


                function displayDateTime() {
                    var today = new Date();
                    var options = {hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: false};
                    var dateFormatter = new Intl.DateTimeFormat('sl-SI', {year: 'numeric', month: 'numeric', day: 'numeric'});
                    var dateTime = dateFormatter.format(today) + ' ' + today.toLocaleTimeString('sl-SI', options);
                    document.getElementById('formClock:clck').innerHTML = dateTime;
                }

                displayDateTime();
                setInterval(displayDateTime, 1000);
            </script>



        </ui:define>

        <ui:define name="content">
            <o:socket channel="PROIDisplaysChannel" onopen="handleOpen" onmessage="handleMessage" onclose="handleClose" />
            <o:socket channel="PROIDisplaysChannelRefresh" onopen="handleOpen" onmessage="handleMessage" onclose="handleClose" />
            <o:socket channel="PROIDisplaysChannelMessage" onopen="handleOpen" onmessage="handleMessage" onclose="handleClose" />
            <h:form id="form">                             
                <p:growl id="PROIgrowl" widgetVar="PROIgrowl" showDetail="true" life="5000" sticky="false"/>     
                <p:remoteCommand name="rcrefresh" oncomplete="ref()" actionListener="#{prodDisplaySingleWorkcenterBean.refreshPageFromWebsocket}" />
                <p:remoteCommand name="ref" onstart="document.getElementById('form:buttonRefresh').click();"/>
                <p:autoUpdate/>
                <h:panelGroup id="wpcontainer" layout="block">
                    <div class="row">
                        <div class="col-lg-12">
                            <div id="gauge"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-3">
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <h2><center>Levi</center></h2>
                                </div>
                                <div class="ibox-content">                
                                    <h:outputText value="Izdelek:" styleClass="dashboardTitle"/><h:panelGroup styleClass="dashboardText" ><marquee width="70%" direction="left" >#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.matLeftDesc}</marquee></h:panelGroup><br/>
                                    <h:outputText value="Ident:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.materialLeft}" styleClass="dashboardText"/><br/>
                                    <h:outputText value="Nalog:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.materialLeftOrder}" styleClass="dashboardText"/><br/>
                                    <h:outputText value="Proizvedeno:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.quantity_left_int}" styleClass="dashboardText"/> <br/>
                                    <h:outputText value="Izmet:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.scrap_left_int}" styleClass="dashboardText"/>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="ibox ">

                                <div class="ibox-title" style="display: none">
                                    <h2><center>Skupaj</center></h2>
                                </div>

                                <div class="ibox-content">
                                    <div class="row">
                                        <div class="col-md-2"></div>
                                        <div class="col-md-8"><center><h:outputText value="Workcenter:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.workcenter}" styleClass="dashboardText"/></center> </div>
                                        <div class="col-md-2"></div>
                                        <!--<div class="col-md-6"><h:outputText value="Delovni nalog:" styleClass="dashboardTitle"/> <h:outputText value="?" styleClass="dashboardText"/> </div>-->
                                        <!--<div class="col-md-6"></div>-->
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6"><h:outputText value="Prijavljenih operaterjev:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.numberOfWorkers_int}" styleClass="dashboardText"/> </div>
                                        <div class="col-md-6"><h:outputText value="Planiranih operaterjev:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.plannedNumberOfWorkers}" styleClass="dashboardText"/> </div>
                                    </div>
                                    <div class="row">

                                        <div class="col-md-6"><h:outputText value="Planirani zastoji:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.downtimeDurationPlanned} min" styleClass="dashboardText"/> </div>
                                        <div class="col-md-6"><h:outputText value="Neplanirani zastoji:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.downtimeDurationUnplanned_int} min" styleClass="dashboardText"/> </div>

                                    </div>  
                                    <div class="row">

                                        <div class="col-md-6"><h:outputText value="Downtime Rate:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.downtimeRate_StringPercentage}" styleClass="dashboardText"/> </div>
                                        <div class="col-md-6"><h:outputText value="Cikel:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.cycle}" styleClass="dashboardText"/> </div>

                                    </div> 
                                    <div class="row">
                                        <div class="col-md-12">
                                            <p:barChart model="#{prodDisplaySingleWorkcenterBean.barModel}" style="width: 100%; height: 200px;"/>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <h2><center>Desni</center></h2>
                                </div>
                                <div class="ibox-content">
                                    <h:outputText value="Izdelek:" styleClass="dashboardTitle"/><h:panelGroup styleClass="dashboardText" ><marquee width="70%" direction="left" >#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.matRightDesc}</marquee></h:panelGroup><br/>
                                    <h:outputText value="Ident:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.materialRight}" styleClass="dashboardText"/> <br/>
                                    <h:outputText value="Nalog:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.materialRightOrder}" styleClass="dashboardText"/><br/>
                                    <h:outputText value="Proizvedeno:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.quantity_right_int}" styleClass="dashboardText"/> <br/>
                                    <h:outputText value="Izmet:" styleClass="dashboardTitle"/> <h:outputText value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.scrap_right_int}" styleClass="dashboardText"/>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="row">

                        <div class="col-md-4">
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <h2><center>Realizacija</center></h2>
                                </div>
                                <div class="ibox-content-okvircek">
                                    <!--<h1 class="no-margins">95%</h1>-->
                                    <!--<div id="chartdiv"></div>-->
                                    <p:chart id="gaugeREALIZACIJA" type="metergauge" model="#{prodDisplaySingleWorkcenterBean.meterGaugeRealizacija}" style="width:100%;height:280px"/>

                                    <div class="col-12 md:col-6 lg:col-12 p-3" style="margin-top: -40px; width: 90% !important; margin-top: -40px; margin-right: auto; margin-bottom: 0px; margin-left: auto;">
                                        <div class="p-3 text-center" style="border-radius: 12px; background-color: #{prodDisplaySingleWorkcenterBean.getBarva_Realizacija()}">
                                            <div class="text-2xl font-medium mb-2" style="color: black; font-weight: bold !important; font-size: 7em !important"><h:outputText id="r1" value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.productivityPercentageString}"/>%</div>
                                            <!--<span class="font-medium" style="color: black">Messages</span>-->
                                        </div>
                                    </div>

                                <!-- <p:commandButton value="Submit" actionListener="#{prodDisplaySingleWorkcenterBean.testirajGaugeRandomData()}" update="gaugeREALIZACIJA"/> -->
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <h2><center>Neplanirani zastoji</center></h2>
                                </div>
                                <div class="ibox-content-okvircek">
                                    <!--<h1 class="no-margins">90%</h1>-->
                                    <!--<div id="chartdivZastoji"></div>-->
                                    <p:chart id="gaugeZASTOJI" type="metergauge" model="#{prodDisplaySingleWorkcenterBean.meterGaugeZastoji}" style="width:100%;height:280px"/>
                                    <div class="col-12 md:col-6 lg:col-12 p-3" style="margin-top: -40px; width: 90% !important; margin-right: auto; margin-bottom: 0px; margin-left: auto;">
                                        <div class="p-3 text-center" style="border-radius: 12px; background-color: #{prodDisplaySingleWorkcenterBean.getBarva_Zastoji()}">
                                            <div class="text-2xl font-medium mb-2" style="color: black; font-weight: bold !important; font-size: 7em !important"><h:outputText id="r2" value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.downtimeDurationUnplanned}"/> min</div>
                                            <!--<span class="font-medium" style="color: black">Messages</span>-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <h2><center>Izmet</center></h2>
                                </div>
                                <div class="ibox-content-okvircek">
                                    <!--<h1 class="no-margins">5%</h1>-->
                                    <!--<div id="chartdivIzmet"></div>-->
                                    <p:chart id="gaugeIZMET" type="metergauge" model="#{prodDisplaySingleWorkcenterBean.meterGaugeIzmet}" style="width:100%;height:280px"/>
                                    <div class="col-12 md:col-6 lg:col-12 p-3" style="margin-top: -40px; width: 90% !important; margin-right: auto; margin-bottom: 0px; margin-left: auto;">
                                        <div class="p-3 text-center" style="border-radius: 12px; background-color: #{prodDisplaySingleWorkcenterBean.getBarva_Izmet()}">
                                            <div class="text-2xl font-medium mb-2" style="color: black; font-weight: bold !important; font-size: 7em !important"><h:outputText id="r3" value="#{prodDisplaySingleWorkcenterBean.selectedWorkcenterDisplay.getScrapRate_StringPercentage()}" /> %</div>
                                            <!--<span class="font-medium" style="color: black">Messages</span>-->
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>

                    </div>

                    <!--
                    <div class="row">
                        <p:barChart model="#{prodDisplaySingleWorkcenterBean.barModel}" style="width: 100%; height: 200px;"/>
                    </div>
                    -->

                    <div class="row">
                        <p:commandButton id="buttonRefresh" style="display: none" value="Submit" actionListener="#{prodDisplaySingleWorkcenterBean.testirajGaugeRandomData()}" update="form:wpcontainer"/>
                    </div>

                </h:panelGroup>

            </h:form>

            <p:dialog header="Obvestilo" widgetVar="dlg2" id="obvestiloDialog" closable="false" minHeight="40" height="75vh" width="80%" showEffect="shake" hideEffect="clip" modal="true" appendTo="@(body)">
                <h:form id="formObvestilo">
                    <p class="p-m-0" style="font-size: 30px">
                        <h:outputText id="obvestilomessage" value="krneki" style="font-size: -webkit-xxx-large"/><br/>
                        <center><img id="imgfoto" src="" height="600" width="800"/></center>
                    </p>
                </h:form>
            </p:dialog>


        </ui:define>

        <ui:define name="beforeEndOfBody">

        </ui:define>


    </ui:composition>
</html>